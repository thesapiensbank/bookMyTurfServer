<html>

<head>
  <!-- Font Awesome -->

  <head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="/admin/img/apple-icon.png">
    <link rel="icon" type="image/png" href="/admin/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
      Book My type - Dashboard
    </title>
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="/admin/css/material-kit.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/css/splide.min.css">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <!-- <script src="js/controller/create.js" type="text/javascript"></script> -->

    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <style type="text/css">
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */


      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      [type="date"] {
        background: #fff url(https://cdn1.iconfinder.com/data/icons/cc_mono_icon_set/blacks/16x16/calendar_2.png) 97% 50% no-repeat;
      }

      [type="date"]::-webkit-inner-spin-button {
        display: none;
      }

      [type="date"]::-webkit-calendar-picker-indicator {
        opacity: 0;
      }

      /* custom styles */
      body {
        background: #e5e5e5;
        font: 13px/1.4 Geneva, 'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', Verdana, sans-serif;
      }

      label {
        display: block;
      }

      input {
        border: 1px solid #c4c4c4;
        border-radius: 5px;
        background-color: #fff;
        padding: 3px 5px;
        box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.1);
        width: 190px;
      }

      /* Table Styles */

      .table-wrapper {
        box-shadow: 0px 1px 6px rgba(0, 0, 0, 0.2);
      }

      .fl-table {
        border-radius: 5px;
        font-size: 15px;
        font-weight: normal;
        border: none;
        border-collapse: collapse;
        width: 100%;
        max-width: 100%;
        white-space: nowrap;
        background-color: white;
      }

      .fl-table td,
      .fl-table th {
        text-align: center;
        padding: 8px;
      }

      .fl-table td {
        border-right: 1px solid #f8f8f8;
        font-size: 15px;
      }

      .fl-table thead th {
        color: #ffffff;
        background: #208090;
      }


      .fl-table thead th:nth-child(odd) {
        color: #ffffff;
        background: #208090;
      }

      .fl-table tr:nth-child(even) {
        background: #F8F8F8;
      }

      /* Responsive */

      @media (max-width: 767px) {
        .fl-table {
          display: block;
          width: 100%;
        }

        .table-wrapper:before {
          content: "Scroll horizontally >";
          display: block;
          text-align: right;
          font-size: 11px;
          color: white;
          padding: 0 0 10px;
        }

        .fl-table thead,
        .fl-table tbody,
        .fl-table thead th {
          display: block;
        }

        .fl-table thead th:last-child {
          border-bottom: none;
        }

        .fl-table thead {
          float: left;
        }

        .fl-table tbody {
          width: auto;
          position: relative;
          overflow-x: auto;
        }

        .fl-table td,
        .fl-table th {
          padding: 20px .625em .625em .625em;
          height: 60px;
          vertical-align: middle;
          box-sizing: border-box;
          overflow-x: hidden;
          overflow-y: auto;
          width: 120px;
          font-size: 13px;
          text-overflow: ellipsis;
        }

        .fl-table thead th {
          text-align: left;
          border-bottom: 1px solid #f7f7f9;
        }

        .fl-table tbody tr {
          display: table-cell;
        }

        .fl-table tbody tr:nth-child(odd) {
          background: none;
        }

        .fl-table tr:nth-child(even) {
          background: transparent;
        }

        .fl-table tr td:nth-child(odd) {
          background: #F8F8F8;
          border-right: 1px solid #E6E4E4;
        }

        .fl-table tr td:nth-child(even) {
          border-right: 1px solid #E6E4E4;
        }

        .fl-table tbody td {
          display: block;
          text-align: center;
        }
      }
    </style>
    <script>

    </script>
  </head>


  <header>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary">
      <div class="container">
        <div class="navbar-translate">
          <a class="navbar-brand" href="javascript:;">Book My Turf</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon"></span>
            <span class="navbar-toggler-icon"></span>
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav">
            <li class="nav-item"><a href="../../turf/list" class="nav-link">Home</a></li>

            <li class="nav-item"><a href="../dashboard-edit/<%= turf._id %>" class="nav-link">Edit Turf</a></li>
           
          </ul>
        </div>
      </div>
    </nav>
    <!-- Navbar -->
  </header>

<body>
  <form id="bookingForm" action="../../turf/booking" method="POST" class="container">

    <div class="  text-center text-light" style="display: none;" id="notice" >

      <p class="py-2 px-3 bg-info" style="filter: drop-shadow(0 0 0.15rem rgb(85, 85, 85));">

        Change Operating Hours if you want to change bookable slots for the selected Date.

      </p>

    </div>

    <div class="row text-center">
      <div class="col-md-3">
        <h3 class="m-2 text-primary "><strong>TURF BOOKING</strong></h3>

      </div>
      <div class="col-md-3">
        <!-- input with datetimepicker -->
        <label for="dateofbirth">Booking Date</label>
        <input type="date" name="date" id="dateofbooking">
      </div>
      <input id="turfid" name="turfid" class="form-check-input" type="hidden" value=<%=turf._id%>>

      <div class="col-md-6 ">
        <button style="float:right" type="submit" class="btn btn-success" id="submit">SAVE</button>
      </div>
    </div>
  
    <div id="mainTurfRow" class="row">
      
    
    
    </div>
  </form>
  
  <!--  End Modal -->
</body>



</body>
<footer>
  <!--   Core JS Files   -->
  <!-- <script src="js/controller/create.js" type="text/javascript"></script> -->
  <script src="/admin/js/core/jquery.min.js" type="text/javascript"></script>
  <script src="/admin/js/core/popper.min.js" type="text/javascript"></script>
  <script src="/admin/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
  <script src="/admin/js/plugins/moment.min.js"></script>
  <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
  <script src="/admin/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <script src="/admin/js/plugins/nouislider.min.js" type="text/javascript"></script>
  <!--  Google Maps Plugin    -->
  <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
  <script src="/admin/js/material-kit.js?v=2.0.7" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/js/splide.min.js"></script>
  <script type="text/javascript" src="/admin/js/main.js"></script>

  <script>
    var turf1 = '<%- JSON.stringify(turf) %>';
    var allTurfTypes = '<%- JSON.stringify(turf.turftype) %>';
    var operatinghours1 = '<%- JSON.stringify(turf.operatinghours) %>'
    console.log(JSON.parse(turf1))
    var turfTypes = {
        turfs: JSON.parse(allTurfTypes),
        operatinghours:JSON.parse(operatinghours1)
      }
    $(document).ready(function () {
      //init DateTimePickers
      materialKit.initFormExtendedDatetimepickers();
      
    });

    $("#dateofbooking").on(' input', function (e) { 
      let mainElementRow = $('#mainTurfRow');
      mainElementRow.empty();
      let date = $(this).val();
      alert(date)

        let type=turfTypes.turfs; 
        
        for(var i=0; i < type.length; i++) { 
            mainElementRow.append(`<div class="col-md-6 text-center">
              <div class="card">
                <div id="id_`+type[i]._id+`" class="card-body p-0">
                <div class="bg-primary m-0 px-5">

                  <div class="row text-light ">
                    <div class="col-md-6">
                      <h4 class="text-left">
                        <strong> `+type[i].name+` </strong>
                      </h4>

                      <h5 class="row text-light text-left"><strong>Booked Slots</strong></h5>
                    </div>
                    <div class="col-md-6">
                      <h5 class="text-right">
                        <strong>Rs `+type[i].rate+` /-</strong>

                      </h5>
                    </div>
                  </div>

                </div>
                <input name="id_`+type[i]._id+`" class="form-check-input" type="hidden" value="`+type[i]._id+` ">
              </div>
              </div>
            </div>`);
            
            let ophPresentAtDate = false;
            let hours = turfTypes.operatinghours[turfTypes.operatinghours.length-1].hours;
            for (let i = 0; i < turfTypes.operatinghours.length; i++) {
              const element = turfTypes.operatinghours[i];
              if(element.date==date){
                ophPresentAtDate = true;
                hours = element.hours;
                break;
              }
            }
            
            if(!ophPresentAtDate)
              {
                  $("#notice").css("display", "block");               
              }
              else{
                $("#notice").css("display", "none");              
              }

            hours.forEach(function(todos)  { 
              let bookedHours = null; 
              let bookedHoursArray = type[i].bookedhours;
               bookedHoursArray.forEach(element => {
                 if(element.date == date){
                   bookedHours = element.hours;
                 }
               });
                  
               
              //   //type[i].bookedhours[type[i].bookedhours.length-1].hours;
               let includeCheck = false;
               console.log('\n Booked hours: ',bookedHours,'\n todos'+todos)
               if (bookedHours != null && bookedHours.length!=0) {
                 console.log("\n\t Booked Hours inside if: " + bookedHours, bookedHours[0].hours)
                 includeCheck = bookedHours.includes(todos);
               }
               
               console.log('\n Include Check: '+ includeCheck);
               console.log(String(includeCheck?'checked':0))
               console.log(turfTypes)
               $(`#id_`+type[i]._id).append(`<div class="form-check form-check-inline">

                <label class="form-check-label">
                <input name="`+type[i]._id +`bhours_` + todos+`" class="form-check-input" type="hidden" value="false">

                <input name="`+type[i]._id+`bhours_`+ todos +`" class="form-check-input" `+String(includeCheck?'checked':0)+` type="checkbox"  `+String(todos?"value=true":0)+`  >

                `+todos+`

                <span class="form-check-sign">

                                  <span class="check"></span>

                                </span>

                </label>

                </div>`)
            
            })
        }

    });
   </script>
</footer>

</html>